---
import { CALENDLY_LINK } from "astro:env/server";
---

<div class="mx-auto flex w-full flex-col items-center justify-center p-2">
	<button
		class="btn-calendly font-tajawal text-taupe mb-2 w-auto border-2 px-5 py-2.5 text-center text-xl font-extrabold tracking-[0.07em] uppercase"
		onclick="window.toggleCalendly()">Book a Free Call</button
	>
	<iframe
		id="calendly-iframe"
		src={`${CALENDLY_LINK}&embed_domain=coachtriciarago.com&embed_type=Inline`}
		style="min-width:320px;height:630px; display:none; width: 100%; border: none;"></iframe>
</div>

<script>
	declare global {
		interface Window {
			toggleCalendly: () => void
		}
	}
	window.toggleCalendly = function () {
		const iframe = document.getElementById("calendly-iframe") as HTMLIFrameElement
		const btn = document.querySelector(".btn-calendly") as HTMLButtonElement

		if (!iframe || !btn) {
			return
		}

		if (iframe.style.display === "none" || iframe.style.display === "") {
			iframe.style.display = "block"
			btn.textContent = "Close Scheduler"
		} else {
			iframe.style.display = "none"
			btn.textContent = "Book a Free Call"
		}
	}

	// reset button onclick on page load (for SPA navigation)
	document.addEventListener("astro:page-load", function () {
		const btn = document.querySelector(".btn-calendly") as HTMLButtonElement
		if (btn) btn.setAttribute("onclick", "window.toggleCalendly()")
	})
</script>
